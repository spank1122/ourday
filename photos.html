<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏£‡∏π‡∏õ‡∏Ñ‡∏π‡πà‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤ ‚ú®</title>
  <link rel="stylesheet" href="assets/theme.css">

<link rel="icon" type="image/png" href="assets/favicon.png">
<meta property="og:title" content="Our Day üíó">
<meta property="og:description" content="‡∏´‡∏°‡∏π‡∏≠‡πâ‡∏ß‡∏ô √ó ‡∏´‡∏°‡∏π‡∏à‡∏¥‡πã‡∏ß">
<meta property="og:image" content="assets/og.png">
<meta property="og:type" content="website">
<meta name="theme-color" content="#ff5e9a">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: linear-gradient(135deg, #ffe6ee 0%, #fff0f7 50%, #ffe6ee 100%);
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
      overflow-x: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      padding: 20px;
    }

    .bubble {
      position: fixed;
      border-radius: 50%;
      pointer-events: none;
      animation: float-down 8s ease-in infinite;
    }
    .bubble::before {
      content: '';
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.8), transparent);
      border-radius: 50%;
    }
    .bubble:nth-child(1) { width: 60px; height: 60px; left: 10%; top: -60px; background: rgba(255, 107, 149, 0.15); animation-delay: 0s; }
    .bubble:nth-child(2) { width: 40px; height: 40px; left: 30%; top: -40px; background: rgba(255, 182, 193, 0.2); animation-delay: 2s; }
    .bubble:nth-child(3) { width: 50px; height: 50px; left: 60%; top: -50px; background: rgba(255, 107, 149, 0.12); animation-delay: 4s; }
    .bubble:nth-child(4) { width: 35px; height: 35px; left: 80%; top: -35px; background: rgba(255, 182, 193, 0.18); animation-delay: 3s; }

    @keyframes float-down {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(120vh) rotate(360deg); opacity: 0; }
    }

    .main-container {
      position: relative;
      z-index: 10;
      width: 100%;
      max-width: 900px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .title {
      font-size: 2.5rem;
      color: #ff6b95;
      font-weight: 700;
      margin-bottom: 10px;
      text-shadow: 0 2px 15px rgba(255, 107, 149, 0.25);
      animation: fadeInDown 0.8s ease-out;
    }

    .subtitle {
      font-size: 1.1rem;
      color: #ff8ab9;
      margin-bottom: 40px;
      font-weight: 400;
      text-shadow: 0 1px 10px rgba(255, 107, 149, 0.15);
      animation: fadeInUp 0.8s ease-out 0.2s both;
    }

    .gallery-container {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(20px);
      border-radius: 30px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(255, 107, 149, 0.2);
      border: 2px solid rgba(255, 107, 149, 0.1);
      animation: fadeInScale 0.8s ease-out 0.4s both;
      width: 100%;
    }

    .controls {
      display: flex;
      gap: 15px;
      margin-bottom: 30px;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
    }

    .btn-primary {
      background: linear-gradient(135deg, #ff5e9a 0%, #ff8ab9 100%);
      color: white;
      padding: 12px 25px;
      border: none;
      border-radius: 20px;
      font-size: 0.95rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: 0 10px 25px rgba(255, 107, 149, 0.2);
      font-family: 'Poppins', sans-serif;
    }
    .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(255, 107, 149, 0.3); }

    .search-bar { flex: 1; min-width: 200px; position: relative; }
    .search-input {
      width: 100%;
      padding: 10px 15px 10px 40px;
      border: 2px solid rgba(255, 107, 149, 0.2);
      border-radius: 20px;
      font-family: 'Poppins', sans-serif;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }
    .search-input:focus {
      outline: none;
      border-color: #ff5e9a;
      box-shadow: 0 0 10px rgba(255, 107, 149, 0.2);
    }
    .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #ff8ab9; font-size: 1rem; }

    .filter-group { display: flex; gap: 10px; flex-wrap: wrap; }
    .filter-btn {
      background: rgba(255, 107, 149, 0.1);
      color: #ff6b95;
      padding: 8px 15px;
      border: 2px solid rgba(255, 107, 149, 0.2);
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      font-size: 0.85rem;
      font-family: 'Poppins', sans-serif;
    }
    .filter-btn:hover, .filter-btn.active {
      background: linear-gradient(135deg, #ff5e9a 0%, #ff8ab9 100%);
      color: white;
      border-color: #ff5e9a;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      animation: fadeIn 0.3s ease;
      overflow-y: auto;
    }
    .modal.show { display: flex; justify-content: center; align-items: center; }
    .modal-content {
      background: white;
      padding: 40px;
      border-radius: 30px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.3s ease;
      margin: 50px 0;
    }
    .modal-header { font-size: 1.5rem; color: #ff6b95; margin-bottom: 25px; font-weight: 700; }

    .form-group { margin-bottom: 20px; }
    .form-label { display: block; color: #ff6b95; font-weight: 600; margin-bottom: 8px; font-size: 0.95rem; }
    .form-label .required { color: #ff4757; }
    .form-input, .form-textarea {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid rgba(255, 107, 149, 0.2);
      border-radius: 15px;
      font-family: 'Poppins', sans-serif;
      font-size: 0.95rem;
      transition: all 0.3s ease;
    }
    .form-input:focus, .form-textarea:focus {
      outline: none;
      border-color: #ff5e9a;
      box-shadow: 0 0 10px rgba(255, 107, 149, 0.2);
    }
    .form-textarea { resize: vertical; min-height: 100px; }

    .form-file-input { display: none; }
    .file-upload-area {
      border: 2px dashed rgba(255, 107, 149, 0.3);
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      background: rgba(255, 107, 149, 0.05);
    }
    .file-upload-area:hover { border-color: #ff5e9a; background: rgba(255, 107, 149, 0.1); }
    .file-upload-icon { font-size: 2rem; margin-bottom: 10px; }
    .file-upload-text { color: #ff6b95; font-weight: 600; font-size: 0.9rem; }

    .modal-buttons { display: flex; gap: 10px; margin-top: 25px; }
    .btn-submit {
      flex: 1;
      background: linear-gradient(135deg, #ff5e9a 0%, #ff8ab9 100%);
      color: white;
      padding: 12px;
      border: none;
      border-radius: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Poppins', sans-serif;
    }
    .btn-submit:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(255, 107, 149, 0.3); }

    .btn-cancel {
      flex: 1;
      background: rgba(255, 107, 149, 0.1);
      color: #ff6b95;
      padding: 12px;
      border: 2px solid rgba(255, 107, 149, 0.2);
      border-radius: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Poppins', sans-serif;
    }
    .btn-cancel:hover { background: rgba(255, 107, 149, 0.2); }

    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .photo-card {
      background: linear-gradient(135deg, rgba(255, 107, 149, 0.1), rgba(255, 182, 193, 0.1));
      border-radius: 20px;
      overflow: hidden;
      border: 2px solid rgba(255, 107, 149, 0.2);
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .photo-card:hover { transform: translateY(-5px); border-color: #ff5e9a; box-shadow: 0 15px 40px rgba(255, 107, 149, 0.3); }

    .photo-image {
      width: 100%;
      height: 180px;
      object-fit: cover;
      display: block;
      background: rgba(255, 107, 149, 0.1);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .photo-image:hover { transform: scale(1.05); }

    .photo-info { padding: 15px; }
    .photo-name {
      color: #ff6b95;
      font-weight: 700;
      margin-bottom: 5px;
      font-size: 0.9rem;
      word-break: break-word;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .photo-date { color: #ffb3d9; font-size: 0.75rem; margin-bottom: 8px; }
    .photo-desc {
      color: #888;
      font-size: 0.8rem;
      line-height: 1.3;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      margin-bottom: 10px;
    }
    .photo-delete {
      width: 100%;
      padding: 6px;
      background: #ffebee;
      color: #ff4757;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.8rem;
      transition: all 0.3s ease;
    }
    .photo-delete:hover { background: #ff4757; color: white; }

    .empty-state { text-align: center; padding: 60px 20px; }
    .empty-state-icon { font-size: 4rem; margin-bottom: 20px; }
    .empty-state-text { color: #ff8ab9; font-size: 1.1rem; margin-bottom: 15px; }

    .pagination {
      display: flex;
      gap: 10px;
      justify-content: center;
      align-items: center;
      margin-top: 30px;
      flex-wrap: wrap;
    }
    .pagination-btn {
      background: rgba(255, 107, 149, 0.1);
      color: #ff6b95;
      padding: 10px 15px;
      border: 2px solid rgba(255, 107, 149, 0.2);
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      font-family: 'Poppins', sans-serif;
      font-size: 0.9rem;
    }
    .pagination-btn:hover, .pagination-btn.active {
      background: linear-gradient(135deg, #ff5e9a 0%, #ff8ab9 100%);
      color: white;
      border-color: #ff5e9a;
    }
    .pagination-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .pagination-info { color: #ff6b95; font-weight: 600; font-size: 0.9rem; }

    .carousel-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 40px;
      width: 100%;
      padding: 0 20px;
    }
    .arrow-buttons { display: flex; gap: 15px; align-items: center; }
    .arrow-btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, #ff5e9a 0%, #ff8ab9 100%);
      color: white;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: 0 15px 40px rgba(255, 107, 149, 0.3);
      font-family: 'Poppins', sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .arrow-btn:hover { transform: scale(1.15); box-shadow: 0 20px 50px rgba(255, 107, 149, 0.4); }
    .arrow-btn:active { transform: scale(1.05); }

    .lightbox {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.9);
      animation: fadeIn 0.3s ease;
    }
    .lightbox.show { display: flex; justify-content: center; align-items: center; }
    .lightbox-content {
      position: relative;
      max-width: 90%;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      animation: zoomIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .lightbox-image {
      max-width: 100%;
      max-height: 70vh;
      object-fit: contain;
      border-radius: 20px;
      margin-bottom: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }
    .lightbox-info { text-align: center; color: white; max-width: 100%; }
    .lightbox-name { font-size: 1.5rem; font-weight: 700; margin-bottom: 10px; }
    .lightbox-desc { font-size: 1rem; color: #ddd; max-width: 600px; word-wrap: break-word; }

    .lightbox-close {
      position: absolute;
      top: 20px;
      right: 20px;
      color: white;
      font-size: 2.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      background: rgba(0, 0, 0, 0.5);
      width: 60px; height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .lightbox-close:hover { background: rgba(255, 107, 149, 0.8); transform: scale(1.1); }

    @keyframes zoomIn { from { opacity: 0; transform: scale(0.8);} to { opacity: 1; transform: scale(1);} }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { opacity: 0; transform: translateY(30px);} to { opacity: 1; transform: translateY(0);} }
    @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px);} to { opacity: 1; transform: translateY(0);} }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px);} to { opacity: 1; transform: translateY(0);} }
    @keyframes fadeInScale { from { opacity: 0; transform: scale(0.9);} to { opacity: 1; transform: scale(1);} }

    @media (max-width: 600px) {
      .title { font-size: 2rem; }
      .gallery-container { padding: 25px; }
      .gallery-grid { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }
      .photo-image { height: 140px; }
      .modal-content { width: 95%; padding: 25px; }
      .controls { flex-direction: column; align-items: stretch; }
      .btn-primary { width: 100%; }
      .search-bar { width: 100%; }
      .filter-group { justify-content: flex-start; overflow-x: auto; padding-bottom: 10px; }
      .filter-btn { white-space: nowrap; }
    }
  </style>
</head>

<body>
<div id="appNav"></div>
<div id="pageFade"></div>

  <!-- Floating Bubbles -->
  <div class="bubble"></div>
  <div class="bubble"></div>
  <div class="bubble"></div>
  <div class="bubble"></div>

  <div class="main-container">
    <h1 class="title">üì∏ ‡∏£‡∏π‡∏õ‡∏Ñ‡∏π‡πà‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤ üì∏</h1>
    <p class="subtitle">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏¢‡∏¢‡∏¥‡πâ‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°</p>

    <div class="gallery-container">
      <div class="controls"></div>

      <div class="gallery-grid" id="galleryGrid"></div>

      <div class="empty-state" id="emptyState" style="display:none;">
        <div class="empty-state-icon">üì∏</div>
        <div class="empty-state-text">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</div>
      </div>

      <div class="pagination" id="pagination"></div>
    </div>

    <div class="carousel-nav">
      <div></div>
      <div class="arrow-buttons">
        <button class="arrow-btn prev" id="prevBtn" onclick="goToHome()" style="display:none;">
          <span>‚åÇ</span>
        </button>
        <button class="arrow-btn next" id="nextBtn" onclick="goToNextPage()" style="display:none;">
          <span>‚ñ∂</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Upload -->
  <div class="modal" id="uploadModal">
    <div class="modal-content">
      <div class="modal-header">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà</div>

      <form id="uploadForm" onsubmit="handleSubmit(event)">
        <div class="form-group">
          <label class="form-label">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û <span class="required">*</span></label>
          <div class="file-upload-area" onclick="document.getElementById('fileInput').click()">
            <div class="file-upload-icon">üì∏</div>
            <div class="file-upload-text" id="fileText">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</div>
          </div>
          <input type="file" id="fileInput" class="form-file-input" accept="image/*" onchange="handleFileSelect(event)">
        </div>

        <div class="form-group">
          <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏π‡∏õ <span class="required">*</span></label>
          <input type="text" class="form-input" id="photoName" placeholder="‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û" required>
        </div>

        <div class="form-group">
          <label class="form-label">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
          <textarea class="form-textarea" id="photoDesc" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏ô‡∏µ‡πâ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)"></textarea>
        </div>

        <div class="modal-buttons">
          <button type="submit" class="btn-submit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          <button type="button" class="btn-cancel" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox">
    <div class="lightbox-content">
      <span class="lightbox-close" onclick="closeLightbox()">‚úï</span>
      <img id="lightboxImage" src="" alt="" class="lightbox-image">
      <div class="lightbox-info">
        <div class="lightbox-name" id="lightboxName"></div>
        <div class="lightbox-desc" id="lightboxDesc"></div>
      </div>
    </div>
  </div>

  <script>
    /***********************
     * SETTINGS (‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ)
     ***********************/
    const ITEMS_PER_PAGE = 12;

    // 1) ‡∏Ñ‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô) ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏•‡∏π‡∏Å‡∏®‡∏£/‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏´‡∏°
    const ALLOW_PUBLIC_PAGINATION = true; // ‚Üê ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô false ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤

    // 2) ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏π‡∏õ ‚Äú‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà‚Äù ‡πÅ‡∏ö‡∏ö localStorage ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞‡∏ï‡πà‡∏≠ backend ‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á
    const PERSIST_MODE = "local"; // "local" | "backend" (‡πÇ‡∏Ñ‡∏£‡∏á‡πÑ‡∏ß‡πâ‡πÄ‡∏â‡∏¢ ‡πÜ)

    // ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢: ‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡πâ‡∏ß‡∏¢ ?admin=1
    const urlParams = new URLSearchParams(window.location.search);
    const isAdmin = urlParams.get('admin') === '1' || sessionStorage.getItem('isAdmin') === 'true';
    if (urlParams.get('admin') === '1') sessionStorage.setItem('isAdmin', 'true');

    /***********************
     * STATE
     ***********************/
    let photos = [];
    let currentFilter = 'all';
    let currentPage = 1;
    let filteredPhotos = [];
    let searchTerm = '';

    /***********************
     * PERSIST (local)
     ***********************/
    function loadPhotos() {
      if (PERSIST_MODE === "local") {
        return JSON.parse(localStorage.getItem('photos') || '[]');
      }
      // TODO: backend
      return [];
    }

    function savePhotos(nextPhotos) {
      if (PERSIST_MODE === "local") {
        localStorage.setItem('photos', JSON.stringify(nextPhotos));
        return;
      }
      // TODO: backend
    }

    /***********************
     * UI: Controls
     ***********************/
    function renderControls() {
      const controlsDiv = document.querySelector('.controls');

      let controlsHTML = `
        <div class="search-bar">
          <span class="search-icon">üîç</span>
          <input type="text" class="search-input" id="searchInput"
            placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà..."
            onkeyup="searchPhotos()">
        </div>
        <div class="filter-group">
          <button class="filter-btn active" onclick="filterPhotos(event, 'all')">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
          <button class="filter-btn" onclick="filterPhotos(event, 'name')">‡∏ä‡∏∑‡πà‡∏≠ A-Z</button>
          <button class="filter-btn" onclick="filterPhotos(event, 'date-new')">‡πÉ‡∏´‡∏°‡πà‡∏Å‡πà‡∏≠‡∏ô</button>
          <button class="filter-btn" onclick="filterPhotos(event, 'date-old')">‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô</button>
        </div>
      `;

      if (isAdmin) {
        controlsHTML = `
          <button class="btn-primary" onclick="openModal()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</button>
        ` + controlsHTML;
      }

      controlsDiv.innerHTML = controlsHTML;
    }

    /***********************
     * Modal
     ***********************/
    function openModal() {
      if (!isAdmin) return;
      document.getElementById('uploadModal').classList.add('show');
    }

    function closeModal() {
      document.getElementById('uploadModal').classList.remove('show');
      document.getElementById('uploadForm').reset();
      document.getElementById('fileText').textContent = 'üì∏ ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û';
    }

    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (file) document.getElementById('fileText').textContent = file.name;
    }

    function handleSubmit(event) {
      event.preventDefault();
      if (!isAdmin) return;

      const fileInput = document.getElementById('fileInput');
      const photoName = document.getElementById('photoName').value;
      const photoDesc = document.getElementById('photoDesc').value;

      if (!fileInput.files[0]) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û'); return; }
      if (!photoName.trim()) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏π‡∏õ'); return; }

      const reader = new FileReader();
      reader.onload = function(e) {
        const newPhoto = {
          id: Date.now(),
          name: photoName.trim(),
          desc: photoDesc || '',
          image: e.target.result,
          date: new Date().toLocaleDateString('th-TH', {
            year: 'numeric', month: '2-digit', day: '2-digit'
          }).split('/').reverse().join('-')
        };

        photos = loadPhotos();
        photos.unshift(newPhoto);
        savePhotos(photos);

        searchTerm = '';
        const searchInput = document.getElementById('searchInput');
        if (searchInput) searchInput.value = '';

        currentFilter = 'all';
        currentPage = 1;
        applyFiltersAndSearch();
        closeModal();
      };
      reader.readAsDataURL(fileInput.files[0]);
    }

    /***********************
     * Search / Filter
     ***********************/
    function searchPhotos() {
      searchTerm = (document.getElementById('searchInput').value || '').toLowerCase();
      currentPage = 1;
      applyFiltersAndSearch();
    }

    function filterPhotos(event, type) {
      if (event) {
        document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
      }
      currentFilter = type;
      currentPage = 1;
      applyFiltersAndSearch();
    }

    function applyFiltersAndSearch() {
      photos = loadPhotos();

      filteredPhotos = photos.filter(photo => {
        const nameMatch = (photo.name || '').toLowerCase().includes(searchTerm);
        const dateMatch = (photo.date || '').includes(searchTerm);
        return nameMatch || dateMatch;
      });

      if (currentFilter === 'name') {
        filteredPhotos.sort((a, b) => (a.name || '').localeCompare((b.name || ''), 'th'));
      } else if (currentFilter === 'date-new') {
        filteredPhotos.sort((a, b) => new Date(b.date) - new Date(a.date));
      } else if (currentFilter === 'date-old') {
        filteredPhotos.sort((a, b) => new Date(a.date) - new Date(b.date));
      }

      // ‡∏Å‡∏±‡∏ô currentPage ‡πÄ‡∏Å‡∏¥‡∏ô totalPages ‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤/‡∏•‡∏ö
      const totalPages = Math.max(1, Math.ceil(filteredPhotos.length / ITEMS_PER_PAGE));
      if (currentPage > totalPages) currentPage = totalPages;

      renderPhotos();
      renderPagination();
      updateArrowButtons();
    }

    /***********************
     * Render Gallery
     ***********************/
    function renderPhotos() {
      const galleryGrid = document.getElementById('galleryGrid');
      const emptyState = document.getElementById('emptyState');

      if (filteredPhotos.length === 0) {
        galleryGrid.innerHTML = '';
        emptyState.style.display = 'block';
        return;
      }

      emptyState.style.display = 'none';

      const start = (currentPage - 1) * ITEMS_PER_PAGE;
      const end = start + ITEMS_PER_PAGE;
      const pagePhotos = filteredPhotos.slice(start, end);

      const photosHTML = pagePhotos.map(photo => {
        const safeName = String(photo.name || '').replace(/'/g, "\\'");
        const safeDesc = String(photo.desc || '').replace(/'/g, "\\'");

        let cardHTML = `
          <div class="photo-card">
            <img src="${photo.image}" class="photo-image" alt="${safeName}"
              onclick="openLightbox('${photo.image}', '${safeName}', '${safeDesc}')">
            <div class="photo-info">
              <div class="photo-name" title="${safeName}">${safeName}</div>
              <div class="photo-date">${formatDate(photo.date)}</div>
              ${photo.desc ? `<div class="photo-desc">${photo.desc}</div>` : ''}
        `;

        if (isAdmin) {
          cardHTML += `<button type="button" class="photo-delete" onclick="deletePhoto(${photo.id})">‡∏•‡∏ö</button>`;
        }

        cardHTML += `
            </div>
          </div>
        `;
        return cardHTML;
      }).join('');

      galleryGrid.innerHTML = photosHTML;
    }

    /***********************
     * Pagination
     ***********************/
    function renderPagination() {
      const pagination = document.getElementById('pagination');
      const totalPages = Math.ceil(filteredPhotos.length / ITEMS_PER_PAGE);

      const canPaginate = isAdmin || ALLOW_PUBLIC_PAGINATION;

      if (!canPaginate || totalPages <= 1) {
        pagination.innerHTML = '';
        return;
      }

      let paginationHTML = '';

      paginationHTML += currentPage > 1
        ? `<button class="pagination-btn" onclick="goToPage(${currentPage - 1})">‚Üê ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>`
        : `<button class="pagination-btn" disabled>‚Üê ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>`;

      for (let i = 1; i <= totalPages; i++) {
        if (i === currentPage) {
          paginationHTML += `<button class="pagination-btn active">${i}</button>`;
        } else if (i <= 3 || i > totalPages - 2 || (i >= currentPage - 1 && i <= currentPage + 1)) {
          paginationHTML += `<button class="pagination-btn" onclick="goToPage(${i})">${i}</button>`;
        } else if (i === 4 || i === totalPages - 3) {
          paginationHTML += `<span class="pagination-info">...</span>`;
        }
      }

      paginationHTML += currentPage < totalPages
        ? `<button class="pagination-btn" onclick="goToPage(${currentPage + 1})">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí</button>`
        : `<button class="pagination-btn" disabled>‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí</button>`;

      pagination.innerHTML = paginationHTML;
    }

    function updateArrowButtons() {
      const totalPages = Math.ceil(filteredPhotos.length / ITEMS_PER_PAGE);
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');

      const canPaginate = isAdmin || ALLOW_PUBLIC_PAGINATION;

      if (!canPaginate || totalPages <= 1) {
        prevBtn.style.display = 'none';
        nextBtn.style.display = 'none';
        return;
      }

      prevBtn.style.display = (currentPage > 1) ? 'flex' : 'none';
      nextBtn.style.display = (currentPage < totalPages) ? 'flex' : 'none';
    }

    function goToHome() { goToPage(1); }

    function goToNextPage() {
      const totalPages = Math.ceil(filteredPhotos.length / ITEMS_PER_PAGE);
      if (currentPage < totalPages) goToPage(currentPage + 1);
    }

    function goToPage(page) {
      currentPage = page;
      renderPhotos();
      renderPagination();
      updateArrowButtons();
      document.querySelector('.gallery-grid').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    /***********************
     * Delete
     ***********************/
    function deletePhoto(id) {
      if (!isAdmin) return;
      if (confirm('‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ô‡∏µ‡πâ?')) {
        photos = loadPhotos().filter(photo => photo.id !== id);
        savePhotos(photos);
        applyFiltersAndSearch();
      }
    }

    /***********************
     * Utils
     ***********************/
    function formatDate(dateStr) {
      if (!dateStr) return '';
      const [year, month, day] = dateStr.split('-');
      const monthNames = ['', '‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.', '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'];
      return `${day} ${monthNames[parseInt(month, 10)]} ${parseInt(year, 10) + 543}`;
    }

    /***********************
     * Lightbox
     ***********************/
    function openLightbox(imageSrc, name, desc) {
      const lightbox = document.getElementById('lightbox');
      document.getElementById('lightboxImage').src = imageSrc;
      document.getElementById('lightboxName').textContent = name;
      document.getElementById('lightboxDesc').textContent = desc || '';
      lightbox.classList.add('show');
    }

    function closeLightbox() {
      document.getElementById('lightbox').classList.remove('show');
    }

    window.addEventListener('click', (e) => {
      const lightbox = document.getElementById('lightbox');
      if (e.target === lightbox) closeLightbox();

      const uploadModal = document.getElementById('uploadModal');
      if (e.target === uploadModal) closeModal();
    });

    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeLightbox();
        closeModal();
      }
    });

    /***********************
     * Init
     ***********************/
    renderControls();
    applyFiltersAndSearch();
  </script>
  <script src="assets/app.js"></script>
</body>
</html>
